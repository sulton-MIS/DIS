DECLARE @@QUERY VARCHAR(MAX);
DECLARE @@START VARCHAR(50) = @START;
DECLARE @@DISPLAY VARCHAR(50) = @DISPLAY;


SET @@QUERY = '';
SET @@QUERY = '
SELECT 
	*
FROM 
(
	SELECT 
		ROW_NUMBER() OVER (ORDER BY A.ID_TB_R_LEARN_REG_PROJ_EMPLOYEE ASC) ROW_NUM
		,A.ID_TB_R_LEARN_REG_PROJ_EMPLOYEE AS ID
		,B.ID_TB_M_EMPLOYEE AS ID_WORKER
		,B.REG_NO AS REG_NO
		,(B.FIRST_NAME + '' '' + B.LAST_NAME) AS EMPLOYEE_NAME
		,C.ID AS ID_PROJECT
		,C.PROJECT_CODE AS PROJECT_CODE
		,C.PROJECT_NAME AS PROJECT_NAME
		,D.ID_TB_M_COMPANY AS ID_COMPANY
		,D.COMPANY_CODE AS COMPANY_CODE
		,D.COMPANY_NAME AS COMPANY_NAME
		,convert(varchar(10), A.DATE_JOIN_PROJECT, 120) AS DATE_JOIN_PROJECT
		,E.ID_TB_M_COMPANY AS ID_COMPANY_FROM
		,E.COMPANY_CODE AS COMPANY_CODE_FROM
		,E.COMPANY_NAME AS COMPANY_NAME_FROM
		,F.ID_TB_M_COMPANY AS ID_COMPANY_TO
		,F.COMPANY_CODE AS COMPANY_CODE_TO
		,F.COMPANY_NAME AS COMPANY_NAME_TO
		,A.IS_PROGRESS AS PROGRESS_STATUS
		,A.IS_DELETED
		,A.CREATED_BY
		,A.CREATED_DT
		,A.UPDATED_BY
		,A.UPDATED_DT
	FROM 
		TB_R_LEARN_REG_PROJ_EMPLOYEE AS A
		LEFT JOIN TB_M_EMPLOYEE AS B ON A.ID_TB_M_EMPLOYEE = B.ID_TB_M_EMPLOYEE
		LEFT JOIN TB_R_WP_PROJECT AS C ON A.ID_TB_R_WP_PROJECT = C.ID
		LEFT JOIN TB_M_COMPANY AS D ON A.ID_TB_M_COMPANY = D.ID_TB_M_COMPANY
		LEFT JOIN TB_M_COMPANY AS E ON A.COMPANY_FROM = E.ID_TB_M_COMPANY --COMPANY FROM
		LEFT JOIN TB_M_COMPANY AS F ON A.COMPANY_TO = F.ID_TB_M_COMPANY --COMPANY FROM
	WHERE 
		A.IS_DELETED = 0

';

IF(@Worker <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND (B.FIRST_NAME + '' '' + B.LAST_NAME) LIKE ''%'+@Worker+'%'' ';
	END
IF(@Project <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND C.PROJECT_NAME LIKE ''%'+@Project+'%'' ';
	END
IF(@Company <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND D.COMPANY_NAME LIKE ''%'+@Company+'%'' ';
	END

SET @@QUERY = @@QUERY +') as TB';

IF(@@START > 0 AND @@DISPLAY > 0)
BEGIN	
	SET @@QUERY = @@QUERY +' WHERE ROW_NUM BETWEEN '+@@START+' AND '''+@@DISPLAY+''' ';
END

EXEC(@@QUERY)