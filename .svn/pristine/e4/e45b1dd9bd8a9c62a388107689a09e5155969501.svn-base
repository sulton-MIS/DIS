DECLARE @@QUERY VARCHAR(MAX);
DECLARE @@START VARCHAR(50) = @START;
DECLARE @@DISPLAY VARCHAR(50) = @DISPLAY;


SET @@QUERY = '';
SET @@QUERY = 'SELECT 
	*
 FROM 
(
	SELECT ROW_NUMBER() OVER (ORDER BY A.ID_TB_M_EMPLOYEE ASC) ROW_NUM,
	A.ID_TB_M_EMPLOYEE AS ID,
	C.COMPANY_NAME AS COMPANY,
	C.ID_TB_M_COMPANY,
	A.FIRST_NAME,
	A.LAST_NAME,
	A.REG_NO AS NOREG,
	A.USERNAME,
	A.PASSWORD,
	A.EMAIL,
	A.ADDRESS,
	(SELECT SYSTEM_VALUE_TXT FROM TB_M_SYSTEM WHERE SYSTEM_ID = ''WP_EMPLOYEE_PIC'' AND SYSTEM_TYPE = A.PIC_STATUS) AS PIC_STATUS_VAL,
	A.PIC_STATUS,
	A.PHONE,
	A.IDENTITY_TYPE,
	A.IDENTITY_NO,
	A.ANZEN_SERTIFICATE_NO,
	CONVERT(VARCHAR(16), A.ANZEN_DT_FROM, 120) AS ANZEN_DT_FROM,
	CONVERT(VARCHAR(16), A.ANZEN_DT_TO, 120) AS ANZEN_DT_TO,
	A.SAFETY_INDUCTION_NO,
	CONVERT(VARCHAR(16),A.SAFETY_INDUCTION_FROM, 120) AS SAFETY_INDUCTION_FROM,
	CONVERT(VARCHAR(16),A.SAFETY_INDUCTION_TO, 120) AS SAFETY_INDUCTION_TO,
	A.STATUS AS STATUSTEXT,
	A.STATUS,
	(CASE WHEN a.SECTION = ''GENERAL'' THEN
			''GENERAL''
		ELSE
			(SELECT distinct TOP 1 DIV FROM [dbo].[TB_M_ORG_RANK] where DIV_ID is not null AND DIV_ID = A.SECTION)		
		END
	) AS SECTION_NAME,
	A.SECTION,
	A.GENDER,
	A.CREATE_BY,
	A.CREATE_DT,
	A.UPDATE_BY,
	A.UPDATE_DT,
	A.IS_DELETED
	FROM TB_M_EMPLOYEE AS A	
	LEFT JOIN TB_M_COMPANY AS C ON A.ID_TB_M_COMPANY = C.ID_TB_M_COMPANY
	WHERE 1=1
	AND (A.IS_DELETED != 1 OR A.IS_DELETED IS NULL)
	AND PIC_STATUS = ''MEM''
';

IF(@EMPLOYEE_NAME <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND (A.FIRST_NAME + '' '' + A.LAST_NAME ) LIKE ''%'+RTRIM(@EMPLOYEE_NAME)+'%'' ';
	END

IF(@IDENTITYNUMBER <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND IDENTITY_NO LIKE ''%'+RTRIM(@IDENTITYNUMBER)+'%'' ';
	END

IF(@COMPANY <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND A.ID_TB_M_COMPANY LIKE ''%'+RTRIM(@COMPANY)+'%'' ';
	END

IF(@ANZENNO <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND A.ANZEN_SERTIFICATE_NO = '''+RTRIM(@ANZENNO)+''' ';
	END

IF(@INDUCTION <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND A.SAFETY_INDUCTION_NO LIKE ''%'+RTRIM(@INDUCTION)+'%'' ';
	END

SET @@QUERY = @@QUERY +') as TB';

IF(@@START > 0 AND @@DISPLAY > 0)
BEGIN	
	SET @@QUERY = @@QUERY +' WHERE ROW_NUM BETWEEN '+@@START+' AND '''+@@DISPLAY+''' ';
END

EXEC(@@QUERY)