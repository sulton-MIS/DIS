
<script>
    var SITE_URL = window.location.href + "/";

    $(document).ready(function () {
        $('#btn_Delete').prop('disabled', true);
        $('#btn_edit').prop('disabled', true);
        $('#btn_clear').prop('disabled', true);

        $('#searchStatus').on('change', function () {
            if (this.value == 'Other') {
                $('#otherStatus').show();
            } else {
                $('#otherStatus').hide();
            }
        });

        HidenValue('add', '2');

        //OnSearch(1);
    });

    // tombol new
    $("#btn_new").on("click", function () {

        $('#modalForm').modal();
        $("#btncloselookup").on("click", function () {
            $('#tambah_data').hide();
        });
    });

    // tombol Add Confirm
    function add_check() {
        var TITLE = $('#addTITLE').val();
        var PASSING_SCORE_REQUIREMENT = $('#addPASSING_SCORE_REQUIREMENT').val();
        var EXAM_DURATION = $('#addEXAM_DURATION').val();
        var DATE_EXAM_PERIOD_START = $('#addDATE_EXAM_PERIOD_START').val();
        var DATE_EXAM_PERIOD_END = $('#addDATE_EXAM_PERIOD_END').val();
        var REMEDIAL = $('#addREMEDIAL_input').val();
        var EXAM_TYPE = $('#addEXAM_TYPE').val();
        var TOTAL_PUBLISHED = $('#addTOTAL_PUBLISHED').val();
        var IS_PUBLISHED = $('#addIS_PUBLISHED').val();
        var Exam_For = $('#addExam_For').val();

        var status = true;
        if (TITLE == null || TITLE == "") {
            toastr.warning("Data Title Cannot be Empty");
            status = false;
        }

        if (PASSING_SCORE_REQUIREMENT == null || PASSING_SCORE_REQUIREMENT == "") {
            toastr.warning("Data Pass Score Requirement Cannot be Empty");
            status = false;
        }

        if (EXAM_DURATION == null || EXAM_DURATION == "") {
            toastr.warning("Data Exam Duration Cannot be Empty");
            status = false;
        }

        if (DATE_EXAM_PERIOD_START == null || DATE_EXAM_PERIOD_START == "") {
            toastr.warning("Data Exam Date Period Start Cannot be Empty");
            status = false;
        }

        if (DATE_EXAM_PERIOD_END == null || DATE_EXAM_PERIOD_END == "") {
            toastr.warning("Data Exam Date Period End Cannot be Empty");
            status = false;
        }

        if (EXAM_TYPE == null || EXAM_TYPE == "") {
            toastr.warning("Data Exam Type Cannot be Empty");
            status = false;
        }

        if (TOTAL_PUBLISHED == null || TOTAL_PUBLISHED == "") {
            toastr.warning("Data Total Publish Cannot be Empty");
            status = false;
        }

        if (IS_PUBLISHED == null || IS_PUBLISHED == "") {
            toastr.warning("Data Is Publish Cannot be Empty");
            status = false;
        }

        if (Exam_For == null || Exam_For == "") {
            toastr.warning("Data Exam For Cannot be Empty");
            status = false;
        }

        if (status == false) {
            return;
        } else {
            $('#PopupForm_AddNewConfirm').modal();
        }
    }

    function addNew_cancel() {
        $('#PopupForm_AddNewConfirm').modal('hide');
    }

    //tombol Add New
    function addNew() {
        var TITLE = $('#addTITLE').val();
        var PASSING_SCORE_REQUIREMENT = $('#addPASSING_SCORE_REQUIREMENT').val();
        var EXAM_DURATION = $('#addEXAM_DURATION').val();
        var DATE_EXAM_PERIOD_START = $('#addDATE_EXAM_PERIOD_START').val();
        var DATE_EXAM_PERIOD_END = $('#addDATE_EXAM_PERIOD_END').val();
        var REMEDIAL = $('#addREMEDIAL_input').val();
        var EXAM_TYPE = $('#addEXAM_TYPE').val();
        var TOTAL_PUBLISHED = $('#addTOTAL_PUBLISHED').val();
        var IS_PUBLISHED = $('#addIS_PUBLISHED').val();
        var Exam_For = $('#addExam_For').val();

        $.ajax({
            type: "POST",
            url: SITE_URL + 'ADD_NEW',
            async: false,
            data: {
                TITLE: TITLE,
                PASSING_SCORE_REQUIREMENT: PASSING_SCORE_REQUIREMENT,
                EXAM_DURATION: EXAM_DURATION,
                DATE_EXAM_PERIOD_START: DATE_EXAM_PERIOD_START,
                DATE_EXAM_PERIOD_END: DATE_EXAM_PERIOD_END,
                REMEDIAL: REMEDIAL,
                EXAM_TYPE: EXAM_TYPE,
                TOTAL_PUBLISHED: TOTAL_PUBLISHED,
                IS_PUBLISHED: IS_PUBLISHED,
                Exam_For: Exam_For
            },
            success: function (res) {
                if (res.sts == "TRUE") {
                    toastr.success("Data Has Been Save Successfuly");

                    $('#addTITLE').val('');
                    $('#addPASSING_SCORE_REQUIREMENT').val('');
                    $('#addEXAM_DURATION').val('');
                    $('#addDATE_EXAM_PERIOD_START').val('');
                    $('#addDATE_EXAM_PERIOD_END').val('');
                    $('#addREMEDIAL_input').val('');
                    $('#addEXAM_TYPE').val('');
                    $('#addTOTAL_PUBLISHED').val('');
                    $('#addIS_PUBLISHED').val('');
                    $('#addExam_For').val('');

                    //$('#btncloselookup').click();
                    $('#PopupForm_AddNewConfirm').modal('hide');
                    $('#modalForm').modal('hide');
                    OnSearch(1);
                } else {
                    toastr.warning(res.Exec[0].LINE_STS);
                }
            },
            error: function (res) {
                toastr.error(res.Message);
            }
        });
    }

    //tombol Edit
    $('#btn_edit').on('click', function () {
        var ID = $('#EditID');
        var TITLE = $('#EditTITLE');
        var PASSING_SCORE_REQUIREMENT = $('#EditPASSING_SCORE_REQUIREMENT');
        var EXAM_DURATION = $('#EditEXAM_DURATION');
        var DATE_EXAM_PERIOD_START = $('#EditDATE_EXAM_PERIOD_START');
        var DATE_EXAM_PERIOD_END = $('#EditDATE_EXAM_PERIOD_END');
        var REMEDIAL = $('#EditREMEDIAL_input');
        var EXAM_TYPE = $('#EditEXAM_TYPE');
        var TOTAL_PUBLISHED = $('#EditTOTAL_PUBLISHED');
        var IS_PUBLISHED = $('#EditIS_PUBLISHED');
        var Exam_For = $('#EditExam_For');

        var Var = "";
        var Send_Var = "";
        var Send_Var = "";
        $("input[name='checkdata[]']").each(function () {
            if ($(this).is(':checked')) {
                Var = "";
                Var = Var + $(this).val();
                Send_Var = Var.split(',');
            }
        });
        ID.val(Send_Var[0]);
        TITLE.val(Send_Var[1]);
        PASSING_SCORE_REQUIREMENT.val(Send_Var[2]);
        EXAM_DURATION.val(Send_Var[3]);
        DATE_EXAM_PERIOD_START.val(Send_Var[4]);
        DATE_EXAM_PERIOD_END.val(Send_Var[5]);
        REMEDIAL.val(Send_Var[6]);
        EXAM_TYPE.val(Send_Var[7]);
        TOTAL_PUBLISHED.val(Send_Var[8]);
        IS_PUBLISHED.val(Send_Var[9]);
        Exam_For.val(Send_Var[10]);

        $('#modalEditForm').modal();
    });

    function cancel_edit() {
        var ID = $('#EditID').val();
        $('#edit_data').hide();
        $('.row-' + ID).show();
    }

    //EditDataConfirm
    function edit_check() {
        var TITLE = $('#EditTITLE').val();
        var PASSING_SCORE_REQUIREMENT = $('#EditPASSING_SCORE_REQUIREMENT').val();
        var EXAM_DURATION = $('#EditEXAM_DURATION').val();
        var DATE_EXAM_PERIOD_START = $('#EditDATE_EXAM_PERIOD_START').val();
        var DATE_EXAM_PERIOD_END = $('#EditDATE_EXAM_PERIOD_END').val();
        var REMEDIAL = $('#EditREMEDIAL_input').val();
        var EXAM_TYPE = $('#EditEXAM_TYPE').val();
        var TOTAL_PUBLISHED = $('#EditTOTAL_PUBLISHED').val();
        var IS_PUBLISHED = $('#EditIS_PUBLISHED').val();
        var Exam_For = $('#EditExam_For').val();

        var status = true;
        if (TITLE == null || TITLE == "") {
            toastr.warning("Data Title Cannot be Empty");
            status = false;
        }

        if (PASSING_SCORE_REQUIREMENT == null || PASSING_SCORE_REQUIREMENT == "") {
            toastr.warning("Data Pass Score Requirement Cannot be Empty");
            status = false;
        }

        if (EXAM_DURATION == null || EXAM_DURATION == "") {
            toastr.warning("Data Exam Duration Cannot be Empty");
            status = false;
        }

        if (DATE_EXAM_PERIOD_START == null || DATE_EXAM_PERIOD_START == "") {
            toastr.warning("Data Exam Date Period Start Cannot be Empty");
            status = false;
        }

        if (DATE_EXAM_PERIOD_END == null || DATE_EXAM_PERIOD_END == "") {
            toastr.warning("Data Exam Date Period End Cannot be Empty");
            status = false;
        }

        if (EXAM_TYPE == null || EXAM_TYPE == "") {
            toastr.warning("Data Exam Type Cannot be Empty");
            status = false;
        }

        if (TOTAL_PUBLISHED == null || TOTAL_PUBLISHED == "") {
            toastr.warning("Data Total Published Cannot be Empty");
            status = false;
        }

        if (IS_PUBLISHED == null || IS_PUBLISHED == "") {
            toastr.warning("Data Is Publish Cannot be Empty");
            status = false;
        }

        if (Exam_For == null || Exam_For == "") {
            toastr.warning("Data Exam For Cannot be Empty");
            status = false;
        }

        if (status == false) {
            return;
        } else {
            $('#PopupForm_EditConfirm').modal();
        }
    }

    function updateData_cancel() {
        $('#PopupForm_EditConfirm').modal('hide');
    }

    function updateData() {
        $("input[name='checkdata[]']").each(function () {
            if ($(this).is(':checked')) {
                var ID = $('#EditID').val();

                var TITLE = $('#EditTITLE').val();
                var PASSING_SCORE_REQUIREMENT = $('#EditPASSING_SCORE_REQUIREMENT').val();
                var EXAM_DURATION = $('#EditEXAM_DURATION').val();
                var DATE_EXAM_PERIOD_START = $('#EditDATE_EXAM_PERIOD_START').val();
                var DATE_EXAM_PERIOD_END = $('#EditDATE_EXAM_PERIOD_END').val();
                var REMEDIAL = $('#EditREMEDIAL_input').val();
                var EXAM_TYPE = $('#EditEXAM_TYPE').val();
                var TOTAL_PUBLISHED = $('#EditTOTAL_PUBLISHED').val();
                var IS_PUBLISHED = $('#EditIS_PUBLISHED').val();
                var Exam_For = $('#EditExam_For').val();

                var Send_Var = ID + "," + TITLE + "," + PASSING_SCORE_REQUIREMENT + "," + EXAM_DURATION + "," + DATE_EXAM_PERIOD_START + "," + DATE_EXAM_PERIOD_END + "," + REMEDIAL + "," + EXAM_TYPE + "," + TOTAL_PUBLISHED + "," + IS_PUBLISHED + "," + Exam_For;

                $.ajax({
                    type: "POST",
                    url: 'WP03002/Update_Data',
                    async: false,
                    data: {
                        DATA: Send_Var
                    },
                    success: function (data) {
                        console.log(Var);
                        if (data.sts == "TRUE") {
                            toastr.success(data.message);
                            cancel_edit();

                            $('#PopupForm_EditConfirm').modal('hide');
                            $('#modalEditForm').modal('hide');
                            OnSearch(1);
                        }
                        else {
                            toastr.warning(data.message);
                        }
                    }
                });
            }
        });

    }

    //tombol Delete
    $("#btn_Delete").on("click", function () {
        $('#Confirmation_Delete_Popup').modal();
    });

    function delete_data() {
        var chk = $("input[name='checkdata[]']:checked").length;
        //alert('hai >> ' + chk);

        if (chk == 0) {
            toastr.warning('Select One or More record to Delete');
            //toastr.warning('Select One or More record to delete.');
        }
        else {
            var Var = "";
            var Send_Var = "";
            $("input[name='checkdata[]']").each(function () {
                if ($(this).is(':checked')) {
                    Var = "";
                    Var = Var + $(this).val();
                    if (Var != '') {
                        Send_Var = Send_Var + Var.split(',')[0] + ",";
                    } else {
                        Send_Var = Send_Var + "," + Var.split(',')[0];
                    }

                }
            });

            $.ajax({
                type: "POST",
                url: 'WP03002/Delete_Data',
                async: false,
                data: {
                    DATA: Send_Var
                },
                success: function (data) {
                    if (data.sts == "TRUE") {
                        toastr.success(data.message);
                    }
                    else {
                        toastr.warning(data.message);
                    }
                    $("#Confirmation_Delete_Popup").modal('hide');

                    OnSearch(1);
                    //xxx
                }
            });
        }
    }

    //tombol clear
    function clear_search() {
        $('#searchTITLE').val("");
        $('#searchEXAM_TYPE').val("");
        $.ajax({
            type: "POST",
            url: SITE_URL + 'Search_Data',
            async: false,
            data: {
                start: 1,
                display: 10,
                DATA_ID: $("#data_nm").val(),
                EXECUTION_TIME: $("#exec_time_cd").val(),
                TIME_UNIT_CRITERIA: $("#time_unit_cd").val(),
                STATUS_ACTIVE: $("#sts_cd").val(),
                TITLE: "xxxxx",
                EXAM_TYPE: "xxxxx",
            },
            success: function (data) {
                $("#GridTable").html(data);
                $("#paging").val(Last_Record_Per_Page);
                if ($('#cntPage').val() == "1") {
                    $('#btn_clear').prop('disabled', false);
                    $('#btn_edit').prop('disabled', true);
                    $('#btn_Delete').prop('disabled', true);
                } else {
                    $('#btn_clear').prop('disabled', false);
                    $('#btn_edit').prop('disabled', true);
                    $('#btn_Delete').prop('disabled', true);
                }

                scroll_and_checkbox();
                cek_perdata();
            }
        });
    }

    // tombol search
    $("#btn_search").on("click", function () {
        OnSearch(1);
    });

    // tombol pencarian data
    function OnSearch(page) {
        searchData(page, $('#paging').val());

        $('#btn_download').prop('disabled', false);
        $('#btn_clear').prop('disabled', false);
    }

    // proses pencarian data
    function searchData(page, size) {
        var TITLE = $('#searchTITLE').val();
        var EXAM_TYPE = $('#searchEXAM_TYPE').val();

        if (status == 'Other') {
            status = $('#otherStatus').val();
        }

        Last_Record_Per_Page = $("#paging").val();
        $.ajax({
            type: "POST",
            url: SITE_URL + 'Search_Data',
            async: false,
            data: {
                start: page,
                display: size,
                DATA_ID: $("#data_nm").val(),
                EXECUTION_TIME: $("#exec_time_cd").val(),
                TIME_UNIT_CRITERIA: $("#time_unit_cd").val(),
                STATUS_ACTIVE: $("#sts_cd").val(),
                TITLE: TITLE,
                EXAM_TYPE: EXAM_TYPE
            },
            success: function (data) {
                $("#GridTable").html(data);
                $("#paging").val(Last_Record_Per_Page);
                if ($('#cntPage').val() == "1") {
                    $('#btn_clear').prop('disabled', false);
                } else {
                    $('#btn_clear').prop('disabled', false);
                }

                scroll_and_checkbox();
                cek_perdata();
            }
        });
    }

    // ceklist per data
    //function cek_perdata() {
    //    $("input[name='checkdata[]']").on("click", function () {
    //        if ($(this).is(':checked')) {
    //            $('#btn_Delete').prop('disabled', false);
    //            total_check = $('.grid-checkbox:checkbox:checked').length;
    //            if (total_check == 1) {
    //                $('#btn_edit').prop('disabled', false);
    //            }

    //            Var = "";

    //            $("input[name='checkdata[]']").each(function () {
    //                if ($(this).is(':checked')) {
    //                    Var = Var + $(this).val();
    //                }
    //            });

    //        }
    //        else {
    //            $('#btn_Delete').prop('disabled', true);
    //            $('#btn_edit').prop('disabled', true);

    //            $("input[name='time_unit_data[]']").prop('disabled', true);
    //            $("input[name='time_value_data[]']").prop('disabled', true);
    //            $("input[name='exec_time_data[]']").prop('disabled', true);
    //            $("input[name='status_data[]']").prop('disabled', true);

    //            $("button[name='btnConfirmEditData[]']").prop('disabled', true);
    //            $("button[name='btncloselookup[]']").prop('disabled', true);
    //        }
    //    });
    //}

    function cek_perdata() {
        $("input[name='checkdata[]']").on("click", function () {

            total_check = $('.grid-checkbox:checkbox:checked').length;
            if (total_check == 1) {
                $('#btn_edit').prop('disabled', false);
                $('#btn_Delete').prop('disabled', false);
            } else if (total_check == 0) {
                $('#btn_edit').prop('disabled', true);
                $('#btn_Delete').prop('disabled', true);
            } else {
                $('#btn_edit').prop('disabled', true);
                $('#btn_Delete').prop('disabled', false);
            }


            if ($(this).is(':checked')) {

            }
            else {

                $("input[name='time_unit_data[]']").prop('disabled', true);
                $("input[name='time_value_data[]']").prop('disabled', true);
                $("input[name='exec_time_data[]']").prop('disabled', true);
                $("input[name='status_data[]']").prop('disabled', true);

                $("button[name='btnConfirmEditData[]']").prop('disabled', true);
                $("button[name='btncloselookup[]']").prop('disabled', true);
            }
        });
    }

    // ceklist all data dan scroll
    function scroll_and_checkbox() {
        $("#tScrollBody").scroll(function () {
            $("#tScrollHead").scrollLeft($("#tScrollBody").scrollLeft());
        });


        $("#checkall").click(function () {
            if ($("#checkall").is(":checked")) {
                $(".grid-checkbox").prop('checked', true);
                $('#btn_Delete').prop('disabled', false);
                $('#btn_edit').prop('disabled', true);
            }
            else {
                $(".grid-checkbox").prop('checked', false);
                $('#btn_Delete').prop('disabled', true);
                $('#btn_edit').prop('disabled', true);
            }
        });
    }

    //hide unhide remedial value
    function HidenValue(form_type, data) {
        //$('#addREMEDIAL_select').html('');
        if (data == "1") {
            $('#' + form_type + 'REMEDIAL_input_times').show();
            $('#' + form_type + 'REMEDIAL_input').val('1');
            $('#' + form_type + 'REMEDIAL_input').show();
        } else {
            $('#' + form_type + 'REMEDIAL_input_times').hide();
            $('#' + form_type + 'REMEDIAL_input').val('0');
            $('#' + form_type + 'REMEDIAL_input').hide();
        }
    }

</script>