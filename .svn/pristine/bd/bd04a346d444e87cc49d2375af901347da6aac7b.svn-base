/************************************************************************************************************
 * Program History :                                                                                        *
 *                                                                                                          *
 * Project Name     : TRAINING PLAINING & REGISTRATION ONLINE                                               *
 * Client Name      : PT. TMMIN (Toyota Manufacturing Motor Indonesia)                                      *
 * Function Id      : TMS040500W                                                                            *
 * Function Name    : Email Sending Batch                                                                   *
 * Function Group   : Registration Control                                                                  *
 * Program Id       : TMS040500BRepository                                                                  *
 * Program Name     : Emai Sending Batch Repository                                                         *
 * Program Type     : Model                                                                                 *
 * Description      :                                                                                       *
 * Environment      : .NET 4.0, ASP MVC 4.0                                                                 *
 * Author           : FID.Arri                                                                              *
 * Version          : 01.00.00                                                                              *
 * Creation Date    : 17/12/2015 11:51:40                                                                   *
 *                                                                                                          *
 * Update history		Re-fix date				Person in charge				Description					*
 *                                                                                                          *
 * Copyright(C) 2015 - Fujitsu Indonesia. All Rights Reserved                                               *                          
 ************************************************************************************************************/

using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using Toyota.Common.Web.Platform;
using Toyota.Common.Database;
using AD021.Models;
using AD021.Models.TMS040500B;
using AD021.Models.AD021000100W;

namespace AD021.Models.TMS040500B
{
    public class TMS040500BRepository
    {
        #region Singleton
        private static TMS040500BRepository instance = null;
        public static TMS040500BRepository Instance
        {
            get
            {
                if (instance == null)
                {
                    instance = new TMS040500BRepository();
                }
                return instance;
            }
        }
        #endregion

        #region ForgetPassword
        public String EmailForgetPassword(string userID, string password, string email)
        {
            string result = "";
            IDBContext db = DatabaseManager.Instance.GetContext();

            try
            {
                db.BeginTransaction();
                dynamic args = new
                {
                    pid = Int64.Parse(DateTime.Now.ToString("yyyyMMddHHmmss")),
                    func = "TMS040500B",
                    uid = userID,
                    result = "success",
                    param = password,
                    aTO = email
                };
                db.Execute("TMS040500B/TMS040500BSendForgetPassword", args);
                db.CommitTransaction();
                result = "Success";
            }
            catch (Exception e)
            {
                db.AbortTransaction();
                result = e.Message.ToString();
            }
            finally
            {
                db.Close();
            }
            return result;
        }
        #endregion
    }
}