DECLARE @@DATE VARCHAR(10);

SET @@DATE = (SELECT TOP 1 DATE FROM TB_R_WP_SECURITY_CHECK WHERE (CHECK_OUT = '' OR CHECK_OUT IS NULL) ORDER BY DATE ASC);

SELECT COUNT(B.ID_TB_M_EMPLOYEE) AS TOTAL_KONTRAKTOR,
ISNULL(sum(case when B.CHECK_IN IS NOT NULL then 1 else  0 end), 0) AS TOTAL_IN,
ISNULL(sum(case when B.CHECK_OUT  IS NOT NULL then 1 else 0 end), 0) AS TOTAL_OUT
FROM TB_R_WP_SECURITY_CHECK AS B 
WHERE DATE >= @@DATE