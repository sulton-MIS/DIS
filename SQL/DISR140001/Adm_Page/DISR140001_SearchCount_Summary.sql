DECLARE @@QUERY VARCHAR(MAX);


SET @@QUERY = '';
SET @@QUERY = '
	SELECT ISNULL(max(ROW_NUM),0) FROM
	(
	   SELECT ROW_NUMBER() OVER (ORDER BY no ASC) ROW_NUM,
       ID_TRANS as ID,
       ID_TRANS as ID_BUNDLE,
       DMC_CODE,
	   QTY_STD as QTY_BUNDLE_STD,
	   QTY as QTY_BUNDLE_ACT,
	   BERAT_BUNDLE_STD as BERAT_BUNDLE_STD,
	   BERAT_BUNDLE_ACT as BERAT_BUNDLE_ACT,
	   JENIS_LOTTO,
	   STATUS_LOTTO,
	   NIK_GAIKAN,
	   OPR_GAIKAN,
	   KETERANGAN,
	   SHF as SHIFT,
	   KALI_PRINT as JML_PRINT,
	   TRANS_DATE,
	   STATUS_CHECKER,
	   CHECKER,
	   CHECKER_DATE,
	   INPUT_ADM,
	   INPUT_DATE,
	   UPDATE_ADM,
	   UPDATE_DATE
    FROM Z_REX_Data_InOut_FG_New
    WHERE 1=1 and id_trans like ''B%''';

IF(@ID_BUNDLE <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND ID_TRANS LIKE ''%'+@ID_BUNDLE+'%'' ';
	END
IF(@DMC_CODE <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND DMC_CODE LIKE ''%'+@DMC_CODE+'%'' ';
	END
IF(@NIK_GAIKAN <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND NIK_GAIKAN LIKE ''%'+@NIK_GAIKAN+'%'' ';
	END
IF(@OPR_GAIKAN <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND OPR_GAIKAN LIKE ''%'+@OPR_GAIKAN+'%'' ';
	END
IF(@TRANS_DATE <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND TRANS_DATE >= '''+@TRANS_DATE+' 0:00:00'' ';
	END

IF(@TRANS_DATETO <> '')
	BEGIN
		SET @@QUERY = @@QUERY + 'AND TRANS_DATE <= '''+@TRANS_DATETO+' 23:59:59'' ';
	END

SET @@QUERY = @@QUERY +' ) as TB';
EXEC(@@QUERY);

