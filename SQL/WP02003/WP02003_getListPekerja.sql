select ID_TB_M_EMPLOYEE, IDENTITY_NO, EMPLOYEE_NAME, TOTAL_INCIDENT from VW_INCIDENT_BY_EMPLOYEE AS A
WHERE A.ID_TB_M_COMPANY = @COMPANY AND SAFETY_INDUCTION_NO != '' AND SAFETY_INDUCTION_TO <= GETDATE()
AND ID_TB_M_EMPLOYEE NOT IN 
(SELECT X.TB_M_EMPLOYEE_ID FROM TB_R_WP_DAILY AS Z 
INNER JOIN TB_R_WP_DAILY_WORKER_LIST AS X ON Z.ID = X.TB_R_WP_DAILY_ID
INNER JOIN TB_R_WP_PROJECT_JOB AS Y ON Z.TB_R_WP_PROJECT_JOB_ID = Y.ID
WHERE Y.END_DATE >= GETDATE()
)