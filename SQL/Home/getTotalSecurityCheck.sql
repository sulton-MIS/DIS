DECLARE @@DATE VARCHAR(MAX);
SET @@DATE = (SELECT TOP 1 DATE FROM TB_R_WP_SECURITY_CHECK WHERE (CHECK_OUT = '' OR CHECK_OUT IS NULL) ORDER BY DATE ASC);
--GET Incident

IF(@@DATE IS NOT NULL)
BEGIN
	--GET ALL TOTAL WORKERS CHECKIN
	SELECT COUNT(ID_TB_M_EMPLOYEE) FROM TB_R_WP_SECURITY_CHECK AS A 
	INNER JOIN TB_R_WP_PROJECT_JOB AS B ON A.ID_TB_R_WP_PROJECT_JOB_ID = B.ID
	INNER JOIN TB_R_WP_PROJECT AS C ON B.WP_PROJECT_ID = C.ID
	WHERE CONVERT(date, @@DATE) >= CONVERT(date, DATE) AND CONVERT(date, getdate()) <= CONVERT(date, DATE)
	AND C.ID_TB_M_AREA = @AREA
END
ELSE
BEGIN
	--GET ALL TOTAL WORKERS CHECKIN
	SELECT COUNT(ID_TB_M_EMPLOYEE) FROM TB_R_WP_SECURITY_CHECK AS A 
	INNER JOIN TB_R_WP_PROJECT_JOB AS B ON A.ID_TB_R_WP_PROJECT_JOB_ID = B.ID
	INNER JOIN TB_R_WP_PROJECT AS C ON B.WP_PROJECT_ID = C.ID
	WHERE CONVERT(date, getdate()) >= CONVERT(date, DATE) AND CONVERT(date, getdate()) <= CONVERT(date, DATE)
	AND C.ID_TB_M_AREA = @AREA
END