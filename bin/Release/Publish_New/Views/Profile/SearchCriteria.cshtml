@using AI070.Models;
@using AI070.Models.Shared;
@using AI070.Models.WP01001Master;
@{
    UserInfo userInfo = (UserInfo)ViewData["UserInfo"];
    List<AreaInfo> AreaInfo = (List<AreaInfo>)ViewData["AreaInfo"];
    List<LocationInfo> LocationInfo = (List<LocationInfo>)ViewData["LocationInfo"];
}

<style>
    #tableSearch {
        border-spacing: 10px;
        border-collapse: separate;
    }

    .updateBtn {
        position: absolute;
        top: 10%;
        right: 0;
    }
</style>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12">
        <div class="panel panel-default">
            <div class="panel-body">

                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h4>COMPANY INFORMATION</h4>
                                <hr />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>COMPANY CODE</label>
                                    <input disabled value="@userInfo.Company_Code" class="form-control" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>COMPANY</label>
                                    <input disabled value="@userInfo.Company" class="form-control" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>SECTION</label>
                                    <input disabled class="form-control" value="@userInfo.Section" type="text" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>AREA</label>
                                    <select class="select2 form-control" id="editArea">
                                        @{
                                            if(AreaInfo.Count > 0)
                                            {
                                                foreach (AreaInfo item in AreaInfo) { 
                                                    <option imagepath="@item.IMAGE_PATH" value="@item.ID">@item.AREA_NAME</option>
                                                }
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>LOCATION</label>
                                    <select class="select2 form-control" id="editLocation">
                                        @{
                                            if (LocationInfo.Count > 0)
                                            {
                                                foreach (LocationInfo item in LocationInfo)
                                                {
                                                    <option class="editLoc" disabled editarea="@item.AREA_ID" value="@item.LOCATION_ID">@item.LOCATION_NAME</option>
                                                }
                                            }
                                        }
                                        </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <img src="@(AreaInfo[0].IMAGE_PATH)" id="editImage" style="width: 100%; height:364px;border:1px dotted grey;display:block" />
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" style="border-left:1px solid grey">
                        <div class="row">
                            <div class="col-md-12">
                                <h4>PROFILE INFORMATION</h4> <button class="updateBtn btn btn-primary btn-xs" onclick="updateData()"><i class="fa fa-save"></i> Update Data</button>
                                <hr />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>NO REG</label>
                                    <input class="form-control" value="@userInfo.NOREG" type="text" disabled />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>USERNAME</label>
                                    <input class="form-control" id="editUsername" value="@userInfo.Username" type="text" />
                                    <input class="form-control" id="editUsernameOld" value="@userInfo.Username" style="display:none" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>PASSWORD</label>
                                    <input class="form-control"  id="editPassword" value="xxxxxxxxxxxxxx" type="password" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>EMAIL</label>
                                    <input class="form-control"  id="editEmail" value="@userInfo.Email" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>FIRST NAME</label>
                                    <input class="form-control"  id="editFirstName" value="@userInfo.First_Name" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>LAST NAME</label>
                                    <input class="form-control"  id="editLastName" value="@userInfo.Last_Name" type="text" />
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>PHONE</label>
                                    <input class="form-control"  id="editPhone" value="@userInfo.Phone" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>GENDER</label>
                                    <select class="form-control" id="editGender">
                                        <option>MALE</option>
                                        <option>FEMALE</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>BIRTH DATE</label>
                                    <input class="form-control"  id="editBirthDate" value="@userInfo.Birth_Date.ToString("yyyy-MM-dd")" type="date" />
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>IDENTITY TYPE</label>
                                    <input disabled class="form-control" value="@userInfo.Identity_Type" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>IDENTITY NO</label>
                                    <input disabled class="form-control" value="@userInfo.Identity_No" type="text" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>PIC STATUS</label>
                                    <input disabled class="form-control" value="@userInfo.PIC_status" type="text" />
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 text-center">
                                <label>IDENTITY IMAGE</label>
                                <img src="~/Content/Upload/Foto/@(userInfo.NOREG).png" style="width: 100%; height:200px;border:1px dotted grey;display:block"/>
                            </div>
                            <div class="col-md-6 text-center">
                                <label>PHOTO IMAGE</label>
                                <img src="~/Content/Upload/KTP/@(userInfo.NOREG).png" style="width: 100%; height:200px; border:1px dotted grey;display:block" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var SITE_URL = window.location.href+"/";
    var Message = [];
    $(document).ready(function () {
        $('.select2').select2({ width: '100%' });
        $('#editArea').val('@userInfo.Area').select2({width:'100%'});
        locationChange();
        $('#editGender').val('@userInfo.Gender');
        $('#editArea').change(function () {
            locationChange(this.value);
        });

        $.ajax({
            url: "Message/GenerateMessage",
            success: function (e) {
                Message = e.res;

                for (var i = 0; i < Message.length; i++) {
                    var MSG_ID = Message[i].MSG_ID;
                    if (MSG_ID == "MWP005") {
                        $('#modal-save-tittle').text(Message[i].MSG_TEXT);
                    } else if (MSG_ID == "MWP006") {
                        $('#modal-delete-tittle').text(Message[i].MSG_TEXT);
                    } else if (MSG_ID == "MWP007") {
                        $('#modal-update-tittle').text(Message[i].MSG_TEXT);
                    }
                }
            }
        });
    });

    function updateData() {
        var AREA = $('#editArea').val();
        var LOCATION = $('#editLocation').val();
        var USERNAME = $('#editUsername').val();
        var USERNAME_OLD = $('#editUsernameOld').val();
        var PASSWORD = $('#editPassword').val();
        if (PASSWORD == 'xxxxxxxxxxxxxx') {
            PASSWORD = '';
        }
        var EMAIL = $('#editEmail').val();
        var FIRST_NAME = $('#editFirstName').val();
        var LAST_NAME = $('#editLastName').val();
        var PHONE = $('#editPhone').val();
        var GENDER = $('#editGender').val();
        var BIRTH_DATE = $('#editBirthDate').val();
        
        $.ajax({
            url: SITE_URL + 'updateData',
            method: "POST",
            data: {
                USERNAME_OLD: USERNAME_OLD,
                AREA: AREA,
                LOCATION: LOCATION,
                USERNAME: USERNAME,
                PASSWORD: PASSWORD,
                EMAIL: EMAIL,
                FIRST_NAME: FIRST_NAME,
                LAST_NAME: LAST_NAME,
                PHONE: PHONE,
                GENDER: GENDER,
                BIRTH_DATE: BIRTH_DATE
            },
            success: function (e) {
                GenerateMessage('Profile', 'MWP003');
            }
        });
    }

    function GenerateMessage(M, Text) {
        for (var i = 0; i < Message.length; i++) {
            var MSG_ID = Message[i].MSG_ID;
            var MSG_TXT = (Message[i].MSG_TEXT).split('{0}');
            var MSG_TYPE = Message[i].MSG_TYPE;
            if (MSG_ID == Text) {
                var NEW_TXT = "";
                for (var e = 0; e < MSG_TXT.length; e++) {
                    if (e < (MSG_TXT.length -1) ) {
                        NEW_TXT = NEW_TXT + MSG_TXT[e] + " " + M;
                    } else {
                        NEW_TXT = NEW_TXT + " " + MSG_TXT[e];
                    }
                }
                if (MSG_TYPE == "Info") {
                    toastr.success(NEW_TXT);
                } else if (MSG_TYPE == "Warning") {
                    toastr.warning(NEW_TXT);
                } else {
                    toastr.error(NEW_TXT);
                }
                
            }
        }
    }

    function locationChange(area_id, type) {
        if (area_id == undefined || area_id == '') {
            area_id = $('#editArea').val();    
        }
        $('.editLoc').attr('disabled', true);
        $('[editarea=' + area_id + ']').attr('disabled', false).select2({ width: '100%' });
        $.get($('#editArea option:selected').attr('imagepath'))
            .done(function () {
            if ($('#editArea option:selected').attr('imagepath') == undefined) {
                GenerateMessage('', 'MWP022');
                $('#editImage').attr('src', '');
            } else {
                $('#editImage').attr('src', $($('#editArea option:selected')[0]).attr('imagepath'));
            }
        }).fail(function () {
            GenerateMessage('', 'MWP022');
            $('#editImage').attr('src', $($('#editArea option:selected')[0]).attr('imagepath'));
        });

        $('#editLocation').val($('#editLocation option:not([disabled]):first').val()).select2({width:'100%'})
    }
</script>